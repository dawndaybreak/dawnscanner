#!/usr/bin/env ruby

require 'codesake-dawn'

raise "Don't use this tool unless you really want to debug dawn" if ENV['CODESAKE_DAWN_DEBUG'].nil?
raise "Missing ruby script to parse" if ARGV.count != 1
raise "I need a directory to inspect" unless File.directory?(ARGV[0])

e = Codesake::Dawn::Sinatra.new({:target=>ARGV[0], :debug=>true})
$logger.log "#{ARGV[0]} - controllers: #{e.controllers.count}, models: #{e.models.count}, views: #{e.views.count}"
$logger.log e.total_lines
e.top_10_most_complex_sources.each do |f|
  $logger.log "#{f.filename} (#{f.cyclomatic_complexity})"
end
# s = Codesake::Dawn::Core::Source.new({:filename=>ARGV[0], :debug=>true, :auto_detect=>true, :mvc=>:padrino})
# $logger.log "Statistics for #{File.basename(s.filename)}"
# $logger.log "Total lines: #{s.total_lines} (empty: #{s.empty_lines}, comments: #{s.comment_lines})"
# $logger.log "Cyclomatic complexity index: #{s.cyclomatic_complexity}"
# $logger.log "Kind: #{s.kind}"
# s.find_sinks
